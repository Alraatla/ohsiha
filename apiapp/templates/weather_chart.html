{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
{% if user.is_authenticated %}
  Hi {{ user.username }}!
  <p>Your location is set to {{ geodata.city }}, {{ geodata.country.name }}. </p>
  <a href="{% url 'update_location' %}">Update location</a>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/data.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<!-- Additional files for the Highslide popup effect -->
<script src="https://www.highcharts.com/media/com_demo/js/highslide-full.min.js"></script>
<script src="https://www.highcharts.com/media/com_demo/js/highslide.config.js" charset="utf-8"></script>
<link rel="stylesheet" type="text/css" href="https://www.highcharts.com/media/com_demo/css/highslide.css" />
<figure class="highcharts-figure">
  <div id="container"></div>
  <p class="highcharts-description">
    Chart showing data loaded dynamically. The individual data points can
    be clicked to display more information.
  </p>
    <p>{% for entry in data %}[{% for e in entry %}{% if forloop.first %}"{{ e.name }}"{% else %}"{{ e }}"{% endif %}{% if not forloop.last %}, {% endif %}{% endfor %}]{% if not forloop.last %}, {% endif %}{% endfor %}</p>
    <p>[null, {% for date in dates %} '{{ date }}'{% if not forloop.last %}, {% endif %}{% endfor %}]</p>
</figure>
  <script>
    Highcharts.chart('container', {

    chart: {
        scrollablePlotArea: {
            minWidth: 700
        }
    },

    data: {
        columns: [
        [null, {% for date in dates %} '{{ date }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
        ['Temperatures', {% for temp in temps %} '{{ temp }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
        {% for entry in data %}[{% for e in entry %}{% if forloop.first %}"{{ e.name }}"{% else %}"{{ e }}"{% endif %}{% if not forloop.last %}, {% endif %}{% endfor %}]{% if not forloop.last %}, {% endif %}{% endfor %}
<!--        ["Hessu", "0", "-1", "1", "4", "4", "3", "1", "0", "0", "0", "0", "3", "5", "5", "1", "0", "0", "0", "2", "5", "7", "7", "3", "2", "1", "0", "4", "7", "10", "11", "7", "4", "3", "2", "8", "14", "16", "14", "9", "8"],-->
<!--        ["Töhnö", "0", "-1", "1", "4", "4", "3", "1", "0", "0", "0", "0", "3", "5", "5", "1", "0", "0", "0", "2", "5", "7", "7", "3", "2", "1", "0", "4", "7", "10", "11", "7", "4", "3", "2", "8", "14", "16", "14", "9", "8"]-->

<!--        {% for entry in data %}[{% for e in entry %}{% if forloop.first %}"{{ e.name }}"{% else %}"{{ e }}"{% endif %}{% if not forloop.last %}, {% endif %}{% endfor %}]{% if not forloop.last %}, {% endif %}{% endfor %}-->

        ]
    },

    title: {
        text: 'Daily sessions at www.highcharts.com'
    },

    subtitle: {
        text: 'Source: Google Analytics'
    },

    xAxis: {
        tickInterval: 24 * 3600 * 1000, // one week
        tickWidth: 0,
        gridLineWidth: 1,
        labels: {
            align: 'left',
            x: 3,
            y: -3
        }
    },

    yAxis: [{ // left y axis
        title: {
            text: 'Goat danger meter'
        },
        labels: {
            align: 'left',
            x: 3,
            y: 16,
            format: '{value:.,0f}'
        },
        showFirstLabel: false
    }, { // right y axis
        linkedTo: 0,
        gridLineWidth: 0,
        opposite: true,
        title: {
            text: 'Goat danger meter'
        },
        labels: {
            align: 'right',
            x: -3,
            y: 16,
            format: '{value:.,0f}'
        },
        showFirstLabel: false
    }],

    legend: {
        align: 'left',
        verticalAlign: 'top',
        borderWidth: 0
    },

    tooltip: {
        shared: true,
        crosshairs: true
    },

    plotOptions: {
        series: {
            cursor: 'pointer',
            point: {
                events: {
                    click: function (e) {
                        hs.htmlExpand(null, {
                            pageOrigin: {
                                x: e.pageX || e.clientX,
                                y: e.pageY || e.clientY
                            },
                            headingText: this.series.name,
                            maincontentText: Highcharts.dateFormat('%A, %b %e, %Y', this.x) + ':<br/> ' +
                                this.y + ' Your goat is freezing! <a href="{% url 'list_goats' %}">Go put it inside</a>',
                            width: 200
                        });
                    }
                }
            },
            marker: {
                lineWidth: 1
            }
        }
    },

    series: [{
        name: 'All sessions',
        lineWidth: 4,
        marker: {
            radius: 4
        }
    }, {
        name: 'New users'
    }]
  });
  </script>
{% endif %}
{% endblock %}